<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orionix Token - Crypto-Platform</title>
    <script>
      (function() {
        try { 
          const savedTheme = localStorage.getItem('theme');
          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          const theme = savedTheme || (prefersDark ? 'dark' : 'light');
          document.documentElement.setAttribute('data-theme', theme);
        } catch (e) {
          console.warn('Could not apply theme from localStorage', e);
        }
      })();
    </script>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
    <nav class="navbar">
        <a href="../index.html" class="logo">Crypto-Platform</a>
        <button class="hamburger">
            <i class="fas fa-bars"></i>
        </button>
        <div class="nav-links">
            <a href="news.html" class="nav-item">News</a>
            <a href="prices.html" class="nav-item">Prices</a>
            <a href="wallet.html" class="nav-item">Wallet</a>
            <a href="trade.html" class="nav-item">Trade</a>
            <a href="orionix.html" class="nav-item active">Orionix</a>
            <div class="auth-buttons mobile">
                <button id="loginBtnMobile" class="auth-btn" onclick="window.location.href='login.html'">Login</button>
                <button id="signupBtnMobile" class="auth-btn" onclick="window.location.href='signup.html'">Sign Up</button>
            </div>
            <button id="themeToggleBtnMobile" class="theme-toggle-btn mobile">
                <i class="fas fa-moon"></i>
            </button>
        </div>
        <div class="controls-desktop">
            <button id="notificationBtn" class="notification-btn">
                <i class="fas fa-bell"></i>
                <span class="alert-badge"></span>
            </button>
            <button id="themeToggleBtn" class="theme-toggle-btn">
                <i class="fas fa-moon"></i>
            </button>
            <div class="auth-buttons desktop">
                <button id="loginBtn" class="auth-btn" onclick="window.location.href='login.html'">Login</button>
                <button id="signupBtn" class="auth-btn" onclick="window.location.href='signup.html'">Sign Up</button>
            </div>
        </div>
    </nav>

    <section class="orionix-section">
        <div class="container">
            <div class="token-details">
                <div class="detail-card">
                    <h3>Informații Generale</h3>
                    <div class="detail-row">
                        <span>Nume:</span>
                        <span>Orionix</span>
                    </div>
                    <div class="detail-row">
                        <span>Simbol:</span>
                        <span>ORX</span>
                    </div>
                    <div class="detail-row">
                        <span>Standard:</span>
                        <span>ERC-20</span>
                    </div>
                    <div class="detail-row">
                        <span>Decimale:</span>
                        <span>18</span>
                    </div>
                    <div class="detail-row">
                        <span>Supply inițial:</span>
                        <span>1,000,000 ORX</span>
                    </div>
                    <div class="detail-row">
                        <span>Rețea:</span>
                        <span>Sepolia Testnet</span>
                    </div>
                    <div class="detail-row contract-address">
                        <span>Adresă Contract:</span>
                        <span id="contract-address">Se încarcă...</span>
                    </div>
                    <div class="detail-row">
                        <span>Stare Contract:</span>
                        <span id="contract-status">Se verifică...</span>
                    </div>
                </div>
                
                <div class="wallet-info-card">
                    <h3>Portofelul Tău</h3>
                    <div class="wallet-connect">
                        <button id="connect-wallet-btn" class="connect-btn">Conectează MetaMask</button>
                        <div id="load-error-message" class="error-message" style="display: none; margin-top: 10px; padding: 8px 12px; background-color: rgba(220, 53, 69, 0.1); color: #dc3545; border-radius: 6px; text-align: center; font-size: 0.9rem;">
                            <i class="fas fa-exclamation-circle"></i> 
                            Nu s-a putut încărca biblioteca ethers.js. <a href="#" id="show-details-btn" style="color: #dc3545; text-decoration: underline;">Afișează detalii</a>
                        </div>
                    </div>
                    <div class="wallet-details">
                        <div class="detail-row">
                            <span>Adresă:</span>
                            <span id="wallet-address">Neconectat</span>
                        </div>
                        <div class="detail-row">
                            <span>Sold ORX:</span>
                            <span id="token-balance">0 ORX</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="token-actions">
                <div class="action-card">
                    <h3>Transfer Tokeni</h3>
                    <div class="form-group">
                        <label for="recipient-address">Adresa Destinatarului:</label>
                        <input type="text" id="recipient-address" placeholder="0x...">
                    </div>
                    <div class="form-group">
                        <label for="transfer-amount">Cantitate:</label>
                        <div class="amount-input">
                            <input type="number" id="transfer-amount" min="0" step="0.01">
                            <span>ORX</span>
                        </div>
                    </div>
                    <button id="transfer-btn" class="action-btn">Transferă Tokeni</button>
                    <div id="transfer-status" class="status-message"></div>
                </div>
                
                <div class="action-card" id="mint-card">
                    <h3>Emite Tokeni Noi (Doar Owner)</h3>
                    <div class="form-group">
                        <label for="mint-address">Adresa Destinatarului:</label>
                        <input type="text" id="mint-address" placeholder="0x...">
                    </div>
                    <div class="form-group">
                        <label for="mint-amount">Cantitate:</label>
                        <div class="amount-input">
                            <input type="number" id="mint-amount" min="0" step="0.01">
                            <span>ORX</span>
                        </div>
                    </div>
                    <button id="mint-btn" class="action-btn">Emite Tokeni</button>
                    <div id="mint-status" class="status-message"></div>
                </div>
            </div>
            
            <div class="transaction-history">
                <h3>Istoricul Tranzacțiilor</h3>
                <div class="transaction-list" id="transaction-list">
                    <div class="empty-state">
                        Conectează-ți portofelul pentru a vedea tranzacțiile tale.
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="../script.js" defer></script>
    <script src="../orionix-interface.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Inițializăm managerul pentru tokenul Orionix
            if (typeof OrionixTokenManager !== 'undefined') {
                const tokenManager = new OrionixTokenManager();
                window.orionixToken = tokenManager; // Expunem managerul global pentru acces ușor
                
                // Actualizăm interfața inițial (adresa contractului și starea acestuia)
                tokenManager.updateUI();
                
                // Adăugăm event listener pentru butonul de conectare
                const connectWalletBtn = document.getElementById('connect-wallet-btn');
                if (connectWalletBtn) {
                    connectWalletBtn.addEventListener('click', async function() {
                        try {
                            connectWalletBtn.textContent = 'Se conectează...';
                            connectWalletBtn.disabled = true;
                            connectWalletBtn.classList.add('loading');
                            
                            await tokenManager.connect();
                            
                            connectWalletBtn.textContent = 'Portofel Conectat';
                            connectWalletBtn.classList.remove('loading');
                            connectWalletBtn.classList.add('connected');
                            document.querySelector('.empty-state').textContent = 'Nu există tranzacții recente.';
                            
                            // Ascundem mesajul de eroare dacă era afișat
                            document.getElementById('load-error-message').style.display = 'none';
                        } catch (error) {
                            console.error(error);
                            
                            // Afișăm mesaj de eroare potrivit pentru utilizator
                            connectWalletBtn.textContent = 'Conectează MetaMask';
                            connectWalletBtn.disabled = false;
                            connectWalletBtn.classList.remove('loading');
                            connectWalletBtn.classList.remove('connected');
                            
                            let errorMessage = 'Eroare de conectare';
                            
                            if (error.message.includes('MetaMask nu este instalat')) {
                                errorMessage = 'MetaMask nu este instalat';
                                window.showCenterAlert('Pentru a continua, instalați extensia MetaMask și creați un portofel.');
                            } else if (error.message.includes('ethers.js')) {
                                errorMessage = 'Eroare bibliotecă';
                                // Afișăm mesajul de eroare special
                                document.getElementById('load-error-message').style.display = 'block';
                                
                                window.showCenterAlert(`
                                    Nu s-a putut încărca biblioteca necesară. Posibile soluții:
                                    <br><br>1. Verificați conexiunea la internet
                                    <br>2. Dezactivați Ad-Blocker sau alte extensii care blochează scripturile
                                    <br>3. Folosiți un browser actualizat (Chrome, Firefox, Edge)
                                    <br>4. Reîncărcați pagina și încercați din nou
                                `, true);
                            } else if (error.code === 4001) {
                                // User a respins conectarea
                                errorMessage = 'Conectare respinsă';
                                window.showCenterAlert('Ați respins conectarea la MetaMask. Pentru a continua, trebuie să vă conectați portofelul.');
                            } else {
                                window.showCenterAlert(`
                                    A apărut o eroare la conectare: ${error.message || 'Eroare necunoscută'}. 
                                    <br><br>Verificați consola pentru detalii.
                                    <br><br>Încercați să reîmprospătați pagina și să verificați dacă MetaMask este configurat corect.
                                `, true);
                            }
                            
                            document.getElementById('wallet-address').textContent = errorMessage;
                        }
                    });
                    
                    // Adăugăm event listener pentru butonul "Afișează detalii"
                    const showDetailsBtn = document.getElementById('show-details-btn');
                    if (showDetailsBtn) {
                        showDetailsBtn.addEventListener('click', function(e) {
                            e.preventDefault();
                            window.showCenterAlert(`
                                <h3 style="margin-top:0">Detalii eroare</h3>
                                <p>Biblioteca ethers.js nu a putut fi încărcată din următoarele motive posibile:</p>
                                <ul style="text-align:left; padding-left:20px;">
                                    <li>Conexiune la internet instabilă</li>
                                    <li>Blocarea scripturilor de către extensii browser (Ad-Blocker, Privacy Blockers)</li>
                                    <li>Politici de securitate restrictive ale browser-ului</li>
                                    <li>Server CDN indisponibil temporar</li>
                                </ul>
                                <p style="margin-bottom:0">Recomandări:</p>
                                <ol style="text-align:left; padding-left:20px;">
                                    <li>Reîncărcați pagina (F5 sau Ctrl+R)</li>
                                    <li>Dezactivați temporar extensiile de blocare a scripturilor</li>
                                    <li>Folosiți un browser modern actualizat (Chrome, Firefox, Edge)</li>
                                    <li>Verificați conexiunea la internet</li>
                                </ol>
                            `, true, 0);
                        });
                    }
                }
                
                // Adăugăm event listener pentru butonul de transfer
                const transferBtn = document.getElementById('transfer-btn');
                if (transferBtn) {
                    transferBtn.addEventListener('click', async function() {
                        const statusElement = document.getElementById('transfer-status');
                        statusElement.textContent = '';
                        
                        try {
                            if (!tokenManager.isConnected) {
                                throw new Error("Portofelul nu este conectat");
                            }
                            
                            const recipientAddress = document.getElementById('recipient-address').value;
                            const amount = document.getElementById('transfer-amount').value;
                            
                            if (!recipientAddress || !amount) {
                                throw new Error("Completați adresa destinatarului și suma");
                            }
                            
                            if (!ethers.utils.isAddress(recipientAddress)) {
                                throw new Error("Adresa destinatarului nu este validă");
                            }
                            
                            statusElement.textContent = "Se procesează transferul...";
                            const tx = await tokenManager.transferTokens(recipientAddress, amount);
                            
                            statusElement.textContent = `Transfer realizat cu succes! Hash tranzacție: ${tx.transactionHash.substring(0, 10)}...`;
                            document.getElementById('recipient-address').value = '';
                            document.getElementById('transfer-amount').value = '';
                            
                            // Actualizăm soldul și istoricul tranzacțiilor
                            tokenManager.updateUI();
                            addTransactionToHistory('transfer', recipientAddress, amount);
                        } catch (error) {
                            statusElement.textContent = `Eroare: ${error.message}`;
                            console.error(error);
                        }
                    });
                }
                
                // Adăugăm event listener pentru butonul de emitere
                const mintBtn = document.getElementById('mint-btn');
                if (mintBtn) {
                    mintBtn.addEventListener('click', async function() {
                        const statusElement = document.getElementById('mint-status');
                        statusElement.textContent = '';
                        
                        try {
                            if (!tokenManager.isConnected) {
                                throw new Error("Portofelul nu este conectat");
                            }
                            
                            const mintAddress = document.getElementById('mint-address').value;
                            const amount = document.getElementById('mint-amount').value;
                            
                            if (!mintAddress || !amount) {
                                throw new Error("Completați adresa destinatarului și suma");
                            }
                            
                            if (!ethers.utils.isAddress(mintAddress)) {
                                throw new Error("Adresa destinatarului nu este validă");
                            }
                            
                            statusElement.textContent = "Se procesează emiterea...";
                            const tx = await tokenManager.mintTokens(mintAddress, amount);
                            
                            statusElement.textContent = `Emitere realizată cu succes! Hash tranzacție: ${tx.transactionHash.substring(0, 10)}...`;
                            document.getElementById('mint-address').value = '';
                            document.getElementById('mint-amount').value = '';
                            
                            // Actualizăm soldul și istoricul tranzacțiilor
                            tokenManager.updateUI();
                            addTransactionToHistory('mint', mintAddress, amount);
                        } catch (error) {
                            statusElement.textContent = `Eroare: ${error.message}`;
                            console.error(error);
                        }
                    });
                }
                
                // Verificăm dacă există adresa contractului și ascundem cardul de mint dacă nu este owner
                if (!window.orionixInfo?.contractAddress) {
                    const mintCard = document.getElementById('mint-card');
                    if (mintCard) {
                        mintCard.style.display = 'none';
                    }
                }
            }
            
            // Funcție pentru adăugarea unei tranzacții în istoric
            window.addTransactionToHistory = function(type, address, amount) {
                const list = document.getElementById('transaction-list');
                if (!list) return;
                
                const emptyState = list.querySelector('.empty-state');
                
                if (emptyState) {
                    list.removeChild(emptyState);
                }
                
                const item = document.createElement('div');
                item.className = 'transaction-item';
                
                const typeIcon = type === 'transfer' ? 'fa-paper-plane' : 'fa-plus-circle';
                const typeText = type === 'transfer' ? 'Transfer către' : 'Emitere către';
                
                item.innerHTML = `
                    <div class="transaction-icon">
                        <i class="fas ${typeIcon}"></i>
                    </div>
                    <div class="transaction-details">
                        <div class="transaction-type">${typeText}</div>
                        <div class="transaction-address">${address.substring(0, 10)}...${address.substring(38)}</div>
                    </div>
                    <div class="transaction-amount">
                        ${type === 'transfer' ? '-' : '+'} ${amount} ORX
                    </div>
                    <div class="transaction-time">
                        ${new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })}
                    </div>
                `;
                
                list.insertBefore(item, list.firstChild);
            };
        });
    </script>
</body>
</html> 